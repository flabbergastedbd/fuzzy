name: fuzzy
version: "0.1"
author: Bharadwaj Machiraju <@tunnelshade_>
about: Does lazy & fuzzy work for you

args:
  - verbose:
      help: Enable debug logging
      short: v
      long: verbose
      global: true

subcommands:
  - master:
      about: Master that can manage workers
      version: "0.1"
      subcommands:
        - start:
            about: Start a master agent
            args:
              - listen_addr:
                  help: "Address to listen for worker connections (Default: 127.0.0.1:12700)"
                  long: listen-addr
                  takes_value: true
              - db_connect_str:
                  help: "Postgres database connection string (Default: postgres://fuzzy:fuzzy@127.0.0.1:5432/fuzzy)"
                  long: db
                  takes_value: true
  - worker:
      about: Workers that perform actual fuzzy computations
      version: "0.1"
      subcommands:
        - start:
            about: Start a worker agent
            args:
              - connect_addr:
                  help: master address to connect (127.0.0.1:12700)
                  index: 1
              - name:
                  help: Identifier for this worker agent
                  long: name
                  takes_value: true
              - uuid:
                  help: Incase of restarting an old agent
                  long: uuid
                  takes_value: true
  - cli:
      about: Command line interface to interact with master
      version: "0.1"
      args:
        - connect_addr:
            help: "Address to listen for worker connections (Default: 127.0.0.1:12700)"
            long: server-addr
            takes_value: true
      subcommands:
        - tasks:
            about: Access/Edit/Remove task information
            subcommands:
                - add:
                    about: Add a new task
                    args:
                        - name:
                            help: Name of the task
                            takes_value: true
                            index: 1
                        - executor:
                            help: Executor for the task
                            takes_value: true
                            possible_values:
                              - Native
                              - Docker
                            index: 2
                        - fuzz_driver:
                            help: Fuzz driver for the task
                            takes_value: true
                            possible_values:
                              - Aflpp
                              - Honggfuzz
                              - Fuzzilli
                              - Libfuzzer
                            index: 3
                - delete:
                    about: Delete a task
                    args:
                      - id:
                          help: Id of task
                          takes_value: true
                          index: 1
                - list:
                    about: List all tasks
        - corpora:
            about: Access/Edit/Remove corpus
            subcommands:
                - add:
                    about: Add a new corpus
                    args:
                        - label:
                            help: Label for corpus
                            takes_value: true
                            index: 1
                        - file_path:
                            help: Executor for the task
                            takes_value: true
                            index: 2
                            multiple: true
                - delete:
                    about: Delete a corpus
                    args:
                      - id:
                          help: Id of task
                          takes_value: true
                          index: 1
                - list:
                    about: List all corpus
                    args:
                        - label:
                            help: Label for corpus
                            index: 1
                            takes_value: true
