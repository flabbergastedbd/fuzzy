name: fuzzy
version: "0.1"
author: Bharadwaj Machiraju <@tunnelshade_>
about: Does lazy & fuzzy work for you

args:
  - verbose:
      help: Enable debug logging
      short: v
      long: debug
      multiple: true
      global: true
      takes_value: false
  - ca:
      help: "CA cert file (Default: ca.crt)"
      long: cert-authority
      takes_value: true
      global: true
  - worker_pem:
      help: "Client identity to talk to server, necessary even for cli (Default: worker.pem)"
      long: client-identity
      takes_value: true
      global: true
  - connect_addr:
      help: "Server address to connect (Default: https://localhost:12700)"
      long: server-url
      takes_value: true
      global: true
subcommands:
  - master:
      about: Master that can manage workers
      version: "0.1"
      subcommands:
        - start:
            about: Start a master agent
            args:
              - listen_addr:
                  help: "Address to listen for worker connections (Default: 127.0.0.1:12700)"
                  long: listen-addr
                  takes_value: true
              - server_pem:
                  help: "PEM file consisting both server cert and key (Default: server.pem)"
                  long: server-identity
                  takes_value: true
              - db_connect_str:
                  help: "Postgres database connection string (Default: postgres://fuzzy:fuzzy@127.0.0.1:5432/fuzzy)"
                  long: db
                  takes_value: true
  - worker:
      about: Workers that perform actual fuzzy computations
      version: "0.1"
      subcommands:
        - start:
            about: Start a worker agent
            args:
              - name:
                  help: Identifier for this worker agent
                  long: name
                  takes_value: true
              - uuid:
                  help: Incase of restarting an old agent
                  long: uuid
                  takes_value: true
              - container_volume:
                  help: "Start agent with docker executor support by providing a mount mapping (<host_path>:<path_inside_container_running_worker>)"
                  takes_value: true
                  index: 1
  - cli:
      about: Command line interface to interact with master
      version: "0.1"
      subcommands:
        - tasks:
            about: Access/Edit/Remove task information
            subcommands:
                - add:
                    about: Add a new task
                    args:
                        - name:
                            help: Name of the task
                            takes_value: true
                            index: 1
                        - profile_path:
                            help: Path to profile path
                            takes_value: true
                            index: 2
                - delete:
                    about: Delete a task
                    args:
                      - id:
                          help: Id of task
                          takes_value: true
                          index: 1
                - list:
                    about: List all tasks
        - corpora:
            about: Access/Edit/Remove corpus
            subcommands:
                - add:
                    about: Add a new corpus
                    args:
                        - label:
                            help: Label for corpus
                            takes_value: true
                            index: 1
                        - file_path:
                            help: Executor for the task
                            takes_value: true
                            index: 2
                            multiple: true
                - delete:
                    about: Delete a corpus
                    args:
                      - id:
                          help: Id of task
                          takes_value: true
                          index: 1
                - list:
                    about: List all corpus
                    args:
                        - label:
                            help: Label for corpus
                            index: 1
                            takes_value: true
        - profile:
            about: Test fuzz profiles
            version: "0.1"
            subcommands:
              - executor:
                  about: Test only executor profile
                  args:
                    - file_path:
                        help: Path to executor profile json
                        takes_value: true
                        index: 1
                    - container_volume:
                        help: "Start agent with docker executor support by providing a mount mapping (<host_path>:<path_inside_container_running_worker>)"
                        takes_value: true
                        index: 2
              - task:
                  about: Test fuzz profile
                  args:
                    - file_path:
                        help: Path to full task profile json
                        takes_value: true
                        index: 1
                    - container_volume:
                        help: "Start agent with docker executor support by providing a mount mapping (<host_path>:<path_inside_container_running_worker>)"
                        takes_value: true
                        index: 2
